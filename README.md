# ブログ記事インポート・エクスポート Plug-in for MovableType
* Author:: Yuichi Takeuchi <uzuki05@takeyu-web.com>
* Website:: [http://takeyu-web.com/](http://takeyu-web.com/)
* Copyright:: Copyright 2013 Yuichi Takeuchi
* License:: MIT-License

ブログ記事/ウェブページ単位のインポート・エクスポート機能を提供します。

![ブログ記事インポート・エクスポート](https://f.cloud.github.com/assets/60980/235657/110d9b28-87b7-11e2-8be9-211f47798c43.png)

エクスポートされた記事は、カテゴリ（ブログ記事）、フォルダ（ウェブページ）、記事アイテムも同時に書き出され、インポート先にて復元されます。

<<<<<<< HEAD
## 機能

+ ブログ記事/ウェブページ一覧からのエクスポート・Zipアーカイブダウンロード
=======
+ 記事･･･出力ファイル名と記事作成時刻をもとに同一記事かを判定、インポート
  + 繰り返しインポートしても重複登録されない
  + インポート先に同一記事が存在し、そちらの更新時刻が新しい場合ログに記録しスキップ
>>>>>>> 6533ac8ff6607cb77724a2ce688d4b9251ff3eb7
+ カテゴリ･･･階層構造、メインカテゴリの選択を維持（移転先に存在しない場合は、階層構造を維持して復元）
+ 記事アイテム･･･ブログ記事に関連付けられたアイテムをエクスポートし、インポート先のブログ記事アイテムとして自動登録します。
  + アイテムに子アイテムが存在する場合は、子アイテムもエクスポート（記事中に埋め込まれたサムネイルなど）
  + 本文、追記中に含まれるアイテムURLの自動書き換え
+ ブラウザインポート
+ コマンドラインインポート


## 動作（するかもしれない）環境

+ MovableType 5.1 5.2 6.0
+ 以下のPerlモジュールが必要
  + Archive::Zip

YAML::Tiny でエラーが発生する場合は YAML::Syck をお試しください。


## 使い方

※ウェブページの場合は、「ブログ記事」を読み替えてください。

### インストール

plugins/EntryExporter を MovableType がインストールされたディレクトリの plugins ディレクトリ内にアップロードして下さい。

その後システムのプラグイン一覧に「Entry Exporter」が追加されていたらOKです。

### エクスポート

エクスポートしたいブログ記事を一覧から選んで、プラグインアクション「ブログ記事のエクスポート」。
エクスポート完了後、自動的にZipアーカイブのダウンロードが開始されます。（件数や画像の枚数などによっては時間がかかります）

### インポート

ブラウザからと、コマンドラインからのインポートに対応しています。

+ ブラウザから ･･･ 手軽、だがサーバーやブラウザの設定等の影響でタイムアウトしたりと厄介な問題も発生しがち
+ コマンドラインから ･･･ 大きなファイルのインポートはこちらの方が確実

#### ブラウザからインポートする

インポートしたいブログの記事一覧リストの上に表示される「ブログ記事のインポート」から、インポートしたいZipアーカイブをアップロード。

<<<<<<< HEAD
### コマンドラインインポート

対象が多く、ブラウザからのインポートではタイムアウトなどの問題がある場合、コマンドラインでのインポートが便利です。

    perl tools/import-entries --blog_id=2 path-th-archive/entries-YYYYMMDDHHMMSS.zip

=======
#### コマンドラインでインポートする

  perl tools/import-entries.pl --blog_id=2 --user_id=1 path-to-file/entries-YYYYMMDDHHMMSS.zip
>>>>>>> 6533ac8ff6607cb77724a2ce688d4b9251ff3eb7

## うまくいかないとき

### アップロードが途中で止まる

####タイムアウトする

少しずつエクスポートするか、以下を試して下さい。よくわかんない人は諦めて下さい。

<<<<<<< HEAD
少しずつエクスポートするか、WebサーバーのCGIタイムアウト値を一時的に大きくしてください。
=======
+ WebサーバーのCGIタイムアウト値を一時的に大きくする
+ ブラウザの設定を変更してHTTPコネクションのタイムアウトを長くする
>>>>>>> 6533ac8ff6607cb77724a2ce688d4b9251ff3eb7

またはコマンドラインでのインポートスクリプトをお試しください。

####アップロードサイズ制限にひっかかる

nginxの場合 client_max_body_size を確認して下さい。

### 「ブログ記事間の関連を追加する」ようなプラグインの、関連が維持されない

本エクスポート機能では、他のプラグインで追加された「関連」は対応できません。
（PowerCMSのオブジェクトを関連付けるカスタムフィールドとか）

対応予定はありません。


## ご注意

* 無保証です。このプラグインを使用したことでいかなる損害が発生しても、制作者（竹内雄一）は一切責任を負いません。
